# Android ç«¯ API è¿ç§»å®ŒæˆæŠ¥å‘Š

> **æ›´æ–°æ—¥æœŸ**: 2026-02-14
> **å½“å‰çŠ¶æ€**: ä»£ç å·²æ›´æ–°ï¼Œå­˜åœ¨ç¼–è¯‘é”™è¯¯éœ€ä¿®å¤

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. API æµ‹è¯•æˆåŠŸ

| æµ‹è¯•é¡¹ | ç»“æœ | Base URL | ç«¯å£ |
|--------|------|----------|------|
| Health Check | âœ… æˆåŠŸ | http://182.92.109.160 | 80 |
| æœç´¢å¡ç‰Œ | âœ… æˆåŠŸ | /api/cards/search | 80 |
| éšæœºå¡ç‰Œ | âœ… æˆåŠŸ | /api/cards/random | 80 |
| ç³»åˆ—åˆ—è¡¨ | âœ… æˆåŠŸ | /api/sets | 80 |
| çƒ­é—¨å¡ç‰Œ | âœ… æˆåŠŸ | /api/stats/popular | 80 |

### 2. API å·®å¼‚å‘ç°

**å®é™… API è·¯å¾„ vs æ–‡æ¡£è·¯å¾„**:

| åŠŸèƒ½ | æ–‡æ¡£è·¯å¾„ | å®é™…è·¯å¾„ | çŠ¶æ€ |
|------|----------|----------|------|
| æœç´¢ | `/api/result` | `/api/cards/search` | âš ï¸ ä¸åŒ |
| éšæœºå¡ç‰Œ | `/api/random` | `/api/cards/random` | âš ï¸ ä¸åŒ |
| å•å¡è¯¦æƒ… | `/api/cards/{id}` | âŒ ä¸æ”¯æŒ | âš ï¸ ç¼ºå¤± |
| ç³»åˆ— | `/api/sets` | `/api/sets` | âœ… ä¸€è‡´ |
| çƒ­é—¨å¡ç‰Œ | `/api/stats/popular` | `/api/stats/popular` | âœ… ä¸€è‡´ |

**å¥½æ¶ˆæ¯**ï¼š
- âœ… API è¿”å›æ•°æ®åŒ…å« `imageUris`ï¼ˆæ— éœ€é¢å¤–è°ƒç”¨ Scryfallï¼‰
- âœ… æ•°æ®ç»“æ„æ›´å®Œæ•´ï¼ˆoracleId, scryfallId, legalities ç­‰ï¼‰
- âœ… åŒ…å« `collectorNumber`, `releasedAt` ç­‰é¢å¤–å­—æ®µ

### 3. å·²åˆ›å»º/æ›´æ–°çš„æ–‡ä»¶

#### æ–°å»ºæ–‡ä»¶

1. **MtgCardServerApi.kt** âœ…
   - è·¯å¾„ï¼š`data/remote/api/mtgserver/MtgCardServerApi.kt`
   - æ›´æ–°ä¸ºå®é™…è·¯å¾„ï¼š`/api/cards/search`, `/api/cards/random`
   - Base URLï¼š`http://182.92.109.160/`ï¼ˆç«¯å£ 80ï¼‰

2. **MtgCardServerResponse.kt** âœ…
   - è·¯å¾„ï¼š`data/remote/api/mtgserver/MtgCardServerResponse.kt`
   - åŒ…å«æ‰€æœ‰å“åº” DTO
   - é€‚é…å®é™… API æ•°æ®ç»“æ„

3. **MtgCardServerMapper.kt** âœ…
   - è·¯å¾„ï¼š`data/remote/api/mtgserver/MtgCardServerMapper.kt`
   - toEntity(): DTO â†’ CardInfoEntity
   - toSearchResultItem(): DTO â†’ SearchResultItem

#### å·²æ›´æ–°æ–‡ä»¶

1. **AppModule.kt** âœ…
   - Base URL æ”¹ä¸ºç«¯å£ 80
   - ç§»é™¤ ScryfallImageApi ç›¸å…³ä»£ç ï¼ˆAPI å·²åŒ…å«å›¾ç‰‡ï¼‰

2. **SearchViewModel.kt** âš ï¸ éƒ¨åˆ†å®Œæˆ
   - æ›´æ–° API è°ƒç”¨
   - å“åº”æ ¼å¼é€‚é…
   - âš ï¸ å­˜åœ¨ç¼–è¯‘é”™è¯¯éœ€ä¿®å¤

3. **DecklistRepository.kt** â³ å¾…æ›´æ–°
   - å¯¼å…¥è¯­å¥å·²æ›´æ–°
   - æ„é€ å‡½æ•°å‚æ•°å·²æ›´æ–°
   - fetchScryfallDetails() æ–¹æ³•éœ€è¦é€‚é…

---

## âŒ å­˜åœ¨çš„ç¼–è¯‘é”™è¯¯

### é”™è¯¯ç±»å‹

```
1. App Module.kt:139:33 - ScryfallImageApi ç±»å‹æ¨æ–­é”™è¯¯
2. App Module.kt:160:46 - MtgchApi æœªå®šä¹‰å¼•ç”¨
3. SearchViewModel.kt:97:38 - cards ç±»å‹æ¨æ–­é”™è¯¯
4. SearchViewModel.kt:102:47 - ç±»å‹æ¨æ–­é”™è¯¯
```

### éœ€è¦ä¿®å¤çš„é—®é¢˜

1. **ScryfallImageApi ä¾èµ–**
   - å·²åˆ é™¤æ–‡ä»¶ï¼Œä½†ä»æœ‰å¼•ç”¨
   - éœ€è¦å®Œå…¨ç§»é™¤ç›¸å…³ä»£ç 

2. **MtgchApi å¼•ç”¨**
   - App Module ä¸­å¯èƒ½ä»æœ‰æ—§ API å¼•ç”¨
   - éœ€è¦å®Œå…¨æ¸…ç†

3. **SearchViewModel ç±»å‹é”™è¯¯**
   - å“åº”è§£æé€»è¾‘éœ€è¦é€‚é…
   - å¯èƒ½éœ€è¦æ˜¾å¼ç±»å‹å£°æ˜

---

## ğŸ”§ ä¸‹ä¸€æ­¥ä¿®å¤è®¡åˆ’

### ç«‹å³ä¿®å¤ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

1. **æ¸…ç† App Module.kt**
   ```kotlin
   // åˆ é™¤è¿™äº›å¼•ç”¨ï¼š
   - import ScryfallImageApi
   - provideScryfallRetrofit()
   - provideScryfallImageApi()
   - provideMtgchRetrofit()
   - provideMtgchApi()
   ```

2. **ä¿®å¤ SearchViewModel.kt**
   ```kotlin
   // ç¡®ä¿ cards ç±»å‹æ˜ç¡®
   val cards: List<MtgCardServerDto> = body.cards ?: emptyList()
   ```

3. **ä¿®å¤ MtgCardServerMapper.kt**
   ```kotlin
   // ä½¿ç”¨æ­£ç¡®çš„å­—æ®µåï¼ˆé©¼å³°å‘½åï¼‰
   val imageUris = this.imageUris?.get("normal")
   ```

### åç»­æ›´æ–°ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

1. **æ›´æ–° DecklistRepository.fetchScryfallDetails()**
   - API è°ƒç”¨ï¼š`mtgCardServerApi.searchCard()`
   - å“åº”æ ¼å¼ï¼š`body.cards`
   - å­—æ®µæ˜ å°„ï¼šé€‚é…æ–°çš„ DTO ç»“æ„

2. **æµ‹è¯•ç¼–è¯‘**
   ```bash
   ./gradlew assembleDebug
   ```

3. **åŠŸèƒ½æµ‹è¯•**
   - å®‰è£…åº”ç”¨åˆ°è®¾å¤‡
   - æµ‹è¯•æœç´¢åŠŸèƒ½
   - éªŒè¯æ•°æ®æ˜¾ç¤º

---

## ğŸ“Š è¿ç§»è¿›åº¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API è¿ç§»è¿›åº¦                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœåŠ¡ç«¯æµ‹è¯•               [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%   â”‚
â”‚ API æ¥å£å®šä¹‰             [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%   â”‚
â”‚ æ•°æ®æ¨¡å‹åˆ›å»º             [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%   â”‚
â”‚ æ•°æ®æ˜ å°„å™¨               [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%   â”‚
â”‚ ä¾èµ–æ³¨å…¥é…ç½®             [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]  60%   â”‚
â”‚ SearchViewModel æ›´æ–°       [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]  50%   â”‚
â”‚ DecklistRepository æ›´æ–°      [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]   0%   â”‚
â”‚ ç¼–è¯‘ä¿®å¤                 [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]   0%   â”‚
â”‚ åŠŸèƒ½æµ‹è¯•                 [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]   0%   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å…³é”®å‘ç°

### æœåŠ¡ç«¯ API ç‰¹ç‚¹

1. **ç«¯å£**: å®é™…è¿è¡Œåœ¨ **ç«¯å£ 80**ï¼ˆä¸æ˜¯ 3000ï¼‰
2. **åŒ…å«å›¾ç‰‡**: æ•°æ®å·²åŒ…å« `imageUris`ï¼Œæ— éœ€é¢å¤–è°ƒç”¨ Scryfall
3. **è·¯å¾„ä¸åŒ**: æœç´¢å’Œéšæœºå¡ç‰Œè·¯å¾„ä¸æ–‡æ¡£ä¸åŒ
4. **å•å¡æŸ¥è¯¢**: ä¸æ”¯æŒé€šè¿‡ ID æŸ¥è¯¢å•å¡
5. **åˆ†é¡µ**: ä½¿ç”¨ `page`, `page_size` å‚æ•°

### æ•°æ®ç»“æ„å¯¹æ¯”

**æ–° API ä¼˜åŠ¿**:
- âœ… è¿”å› `oracleId` å’Œ `scryfallId`
- âœ… åŒ…å«å®Œæ•´çš„ `imageUris` (small, normal, large, png)
- âœ… åŒ…å« `collectorNumber` å’Œ `releasedAt`
- âœ… `legalities` æ ¼å¼æ›´æ ‡å‡†

**éœ€è¦é€‚é…**:
- âš ï¸ `cm c` æ˜¯ Double ç±»å‹
- âš ï¸ ä½¿ç”¨ `imageUris` Map è€Œéç›´æ¥å­—æ®µ
- âš ï¸ æ²¡æœ‰ `zh_name`ï¼ˆå¯èƒ½æœ‰å…¶ä»–ä¸­æ–‡å­—æ®µï¼‰

---

## ğŸ¯ å¿«é€Ÿä¿®å¤æŒ‡å—

### ä¿®å¤ç¼–è¯‘é”™è¯¯æ­¥éª¤

**1. å®Œå…¨æ¸…ç† App Module.kt**
```kotlin
// åˆ é™¤æ‰€æœ‰ ScryfallImageApi ç›¸å…³ä»£ç 
// åˆ é™¤æ‰€æœ‰ MtgchApi ç›¸å…³ä»£ç 
// åªä¿ç•™ MtgCardServerApi ç›¸å…³
```

**2. ä¿®å¤ SearchViewModel.kt**
```kotlin
// ç¡®ä¿ cards ç±»å‹æ˜ç¡®
val cards: List<MtgCardServerDto> = response.body()?.cards ?: emptyList()

// ç§»é™¤å¯¹ items çš„å¼•ç”¨ï¼Œæ”¹ä¸º cards
val results = cards.map { it.toSearchResultItem() }
```

**3. éªŒè¯ç¼–è¯‘**
```bash
./gradlew clean
./gradlew assembleDebug
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **API_MIGRATION_GUIDE.md** - åŸå§‹è¿ç§»æŒ‡å—
- **MIGRATION_STATUS_v4.4.0.md** - ä¹‹å‰çš„è¿ç§»çŠ¶æ€
- **SERVER_TEST_REPORT.md** - æœåŠ¡ç«¯æµ‹è¯•æŠ¥å‘Š

---

**æœ€åæ›´æ–°**: 2026-02-14
**ä¸‹ä¸€æ­¥**: ä¿®å¤ç¼–è¯‘é”™è¯¯å¹¶å®Œæˆæµ‹è¯•
